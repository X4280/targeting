<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Client ➜ Targeting Lookup</title>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Prevent accidental selection of non‑copy columns */
      td.select-none,
      th.select-none {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
    </style>
  </head>
  <body class="bg-slate-50">
    <div id="root"></div>

    <!-- React + React‑DOM (production builds) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <!-- Babel (compile JSX in the browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <!-- App code (static CSV in repo) -->
    <script type="text/babel">
      const { useState, useEffect } = React;

      const CSV_URL = "clients.csv"; // CSV lives next to this file on Vercel

      async function loadClients() {
        const res = await fetch(CSV_URL);
        const text = await res.text();
        return new Promise((resolve) => {
          Papa.parse(text, {
            header: true,
            skipEmptyLines: true,
            complete: ({ data }) => {
              const cleaned = data
                .filter((row) => row.Client && row.Targetting)
                .map((row) => {
                  const excludeFlag = (row.Exclude || row.exclude || row.Type || "")
                    .toString()
                    .toLowerCase()
                    .includes("exclude");
                  return {
                    name: row.Client.trim(),
                    location: row.Targetting.trim(),
                    radius: row.Radius?.trim() || null,
                    exclude: excludeFlag,
                  };
                });
              resolve(cleaned);
            },
          });
        });
      }

      function App() {
        const [clients, setClients] = useState([]);
        const [query, setQuery] = useState("");
        const [copiedInclude, setCopiedInclude] = useState(false);
        const [copiedExclude, setCopiedExclude] = useState(false);
        const [copiedRow, setCopiedRow] = useState(null); // track clicked radius row index

        useEffect(() => {
          loadClients().then(setClients);
        }, []);

        const filtered = clients.filter((c) =>
          c.name.toLowerCase().includes(query.toLowerCase())
        );

        // Grouped rows
        const radiusRows = filtered.filter((c) => c.radius && !c.exclude);
        const includedRows = filtered.filter((c) => !c.radius && !c.exclude);
        const excludedRows = filtered.filter((c) => c.exclude);

        const orderedRows = [...radiusRows, ...includedRows, ...excludedRows];

        const copyRows = (rows, setFlag) => {
          if (rows.length === 0) return;
          navigator.clipboard.writeText(rows.map((c) => c.location).join("\n"));
          setFlag(true);
          setTimeout(() => setFlag(false), 2000);
        };

        const handleRadiusClick = (idx, location) => {
          navigator.clipboard.writeText(location);
          setCopiedRow(idx);
          setTimeout(() => setCopiedRow(null), 1500);
        };

        return (
          <main className="min-h-screen flex flex-col items-center p-8 gap-8">
            <h1 className="text-3xl font-bold text-slate-800">Client ➜ Targeting Lookup</h1>

            <input
              type="text"
              placeholder="Type client name (e.g. Essential)"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
